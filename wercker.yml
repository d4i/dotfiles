box: ubuntu
build:
  steps:
    - script:
        name: prepare required packages
        code: |
          apt-get -y update
          apt-get -y install sudo ssh fabric python-yaml
    - script:
        name: set up ssh
        code: |
          service ssh start
          ssh-keygen -t rsa -N '' -f ~/.ssh/id_rsa
          mv ~/.ssh/id_rsa.pub ~/.ssh/authorized_keys
          chmod 600 ~/.ssh/authorized_keys
          touch ~/.ssh/config
    - script:
        name: install packages with dev.setup_system
        code: fab -i ~/.ssh/id_rsa dev.setup_system
    - script:
        name: set up zsh with dev.setup_zsh
        code: fab -i ~/.ssh/id_rsa dev.setup_zsh
    - script:
        name: set up vim with dev.setup_vim
        code: fab -i ~/.ssh/id_rsa dev.setup_vim
    - script:
        name: set up python 2 with dev.setup_py
        code: fab -i ~/.ssh/id_rsa dev.setup_py:2
    - script:
        name: set up python 3 with dev.setup_py
        code: fab -i ~/.ssh/id_rsa dev.setup_py:3
    - script:
        name: set up ruby 2 with dev.setup_rb
        code: fab -i ~/.ssh/id_rsa dev.setup_rb:2
    - script:
        name: set up go with dev.setup_go
        code: fab -i ~/.ssh/id_rsa dev.setup_go
    - script:
        name: set up r with dev.setup_r
        code: fab -i ~/.ssh/id_rsa dev.setup_r
push:
  steps:
    - internal/docker-push:
        username: dceoy
        password: $DOCKER_PASS
        tag: latest
        repository: dceoy/dev
        registry: https://registry.hub.docker.com
